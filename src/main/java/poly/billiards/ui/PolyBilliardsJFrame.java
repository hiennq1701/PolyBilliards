/*
* Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package poly.billiards.ui;

import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.SwingUtilities;
import poly.billiards.util.XAuth;
import poly.billiards.util.XIcon;
import poly.billiards.util.XUI;
import poly.billiards.util.XDialog;
import java.awt.Color;
import javax.swing.JButton;
import javax.swing.ImageIcon;
import java.awt.BorderLayout;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.util.List;
import javax.swing.*;
import javax.swing.border.EmptyBorder;
import javax.swing.table.DefaultTableModel;
import poly.billiards.dao.BillDAO;
import poly.billiards.dao.UserDAO;
import poly.billiards.dao.impl.UserDAOImpl;
import poly.billiards.entity.Bill;
import poly.billiards.entity.Billinfo;
import poly.billiards.entity.Food;
import poly.billiards.entity.FoodCategory;
import poly.billiards.entity.Menu;
import poly.billiards.entity.User;
import poly.billiards.ui.ChatWindowJDialog;
import poly.billiards.ui.manager.FoodCategoryManagerJDialog;
import poly.billiards.ui.manager.FoodManagerJDialog;
import poly.billiards.ui.manager.UserManagerJDialog;
import poly.billiards.ui.manager.TableManagerJDialog;
import poly.billiards.ui.manager.typeTableManagerJDialog;
import poly.billiards.util.XDialog;
import poly.billiards.util.XActivity;
import java.util.Map;
import java.util.HashMap;
import java.text.SimpleDateFormat;
import java.awt.Dimension;
import java.util.ArrayList;
import java.util.Collections;
import java.awt.BasicStroke;
import java.awt.event.ItemEvent;
import static java.awt.image.ImageObserver.HEIGHT;
import java.sql.Timestamp;
import java.util.Date;
import javaswingdev.drawer.Drawer;
import javaswingdev.drawer.DrawerController;
import javaswingdev.drawer.DrawerItem;
import javaswingdev.drawer.EventDrawer;
import javax.swing.BorderFactory;
import poly.billiards.dao.BillInfoDAO;
import poly.billiards.dao.FoodCategoryDAO;
import poly.billiards.dao.FoodDAO;
import poly.billiards.dao.MenuDAO;
import poly.billiards.dao.impl.FoodCategoryDAOImpl;
import poly.billiards.dao.impl.FoodDAOImpl;
import poly.billiards.dao.TableDAO;
import poly.billiards.dao.impl.TableDAOImpl;
import poly.billiards.entity.Table;
import poly.billiards.util.XDateHelper;
import poly.billiards.util.XHourlyRateCalculator;
import poly.billiards.ui.component.HeaderDrawer;

/**
 *
 * @author DELL
 */
public final class PolyBilliardsJFrame extends javax.swing.JFrame implements PolyBilliardsController, DataChangeListener {

//    private JButton btnChat;
//    private JButton btnActivityHistory;
//    private JButton btnToggleTheme;
//    private JButton btnLogout;
    private User currentUser;
    private XHourlyRateCalculator hourlyRateCalculator;

    // Thêm biến để theo dõi thời gian chơi
    private javax.swing.Timer playTimeTimer;
    private long startTime;
    private boolean isPlaying = false;

    // Thêm biến để theo dõi trạng thái dừng/tiếp tục
    private boolean isPaused = false;
    private long pauseTime = 0;
    private long totalPausedTime = 0;

    private DefaultTableModel modelTable;
    FoodCategoryDAO fcatedao = new FoodCategoryDAOImpl();

    FoodDAO fdao = new FoodDAOImpl();
    MenuDAO menudao = new MenuDAO();
    BillDAO billdao = new BillDAO();
    BillInfoDAO billifdao = new BillInfoDAO();
    int idtable;
    int count = 0;
    JButton clickbt;

    /**
     * Creates new form AppJFrame
     */
    public PolyBilliardsJFrame() {
        initComponents();
        this.init();
        this.setLocationRelativeTo(null);
        // Thêm Timer để cập nhật thời gian thực
        javax.swing.Timer timer = new javax.swing.Timer(1000, e -> updateTime());
        timer.start();
        updateTime();
    }

    public PolyBilliardsJFrame(User currentUser) {
        this.currentUser = currentUser;
        System.out.println("PolyBilliardsJFrame constructor - currentUser: " + (currentUser != null ? currentUser.getFullname() : "null"));
        initComponents();
        this.init();
        this.setLocationRelativeTo(null);
        this.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
        // Thêm Timer để cập nhật thời gian thực
        javax.swing.Timer timer = new javax.swing.Timer(1000, e -> updateTime());
        timer.start();
        updateTime();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlLeft = new javax.swing.JPanel();
        pnlLeftCenter = new javax.swing.JPanel();
        btnDrawerManager = new javax.swing.JButton();
        btnDrawerUser = new javax.swing.JButton();
        btnToggleTheme = new javax.swing.JButton();
        tabs = new javax.swing.JTabbedPane();
        jPanel9 = new javax.swing.JPanel();
        jPanel10 = new javax.swing.JPanel();
        btnLiber10 = new javax.swing.JButton();
        btnLiber11 = new javax.swing.JButton();
        btnLiber1 = new javax.swing.JButton();
        btnLiber6 = new javax.swing.JButton();
        btnLiber9 = new javax.swing.JButton();
        btnLiber12 = new javax.swing.JButton();
        btnLiber3 = new javax.swing.JButton();
        btnLiber5 = new javax.swing.JButton();
        btnLiber4 = new javax.swing.JButton();
        btnLiber8 = new javax.swing.JButton();
        btnLiber2 = new javax.swing.JButton();
        btnLiber7 = new javax.swing.JButton();
        jPanel11 = new javax.swing.JPanel();
        btnVip2 = new javax.swing.JButton();
        btnVip3 = new javax.swing.JButton();
        btnVip1 = new javax.swing.JButton();
        jPanel12 = new javax.swing.JPanel();
        btnLo1 = new javax.swing.JButton();
        btnLo2 = new javax.swing.JButton();
        btnLo3 = new javax.swing.JButton();
        btnLo4 = new javax.swing.JButton();
        btnLo5 = new javax.swing.JButton();
        jPanel13 = new javax.swing.JPanel();
        txtPhiDichVu = new javax.swing.JTextField();
        jLabel19 = new javax.swing.JLabel();
        snpCount = new javax.swing.JSpinner();
        btnStopContinue = new javax.swing.JButton();
        btnThanhToan = new javax.swing.JButton();
        btnXacNhan = new javax.swing.JButton();
        jSeparator3 = new javax.swing.JSeparator();
        jLabel20 = new javax.swing.JLabel();
        btnTamTinh = new javax.swing.JButton();
        jSeparator6 = new javax.swing.JSeparator();
        lbTienGio = new javax.swing.JLabel();
        jLabel22 = new javax.swing.JLabel();
        jSeparator7 = new javax.swing.JSeparator();
        txtTimeStart = new javax.swing.JTextField();
        lbMaHoaDon = new javax.swing.JLabel();
        jSeparator8 = new javax.swing.JSeparator();
        jLabel23 = new javax.swing.JLabel();
        txtTimeStop = new javax.swing.JTextField();
        jLabel24 = new javax.swing.JLabel();
        btnStart = new javax.swing.JButton();
        jScrollPane4 = new javax.swing.JScrollPane();
        txtGhiChu = new javax.swing.JTextArea();
        jLabel25 = new javax.swing.JLabel();
        jPanel14 = new javax.swing.JPanel();
        jLabel26 = new javax.swing.JLabel();
        lbTable = new javax.swing.JLabel();
        lbDateNow = new javax.swing.JLabel();
        jLabel27 = new javax.swing.JLabel();
        jLabel28 = new javax.swing.JLabel();
        jLabel29 = new javax.swing.JLabel();
        lbTongTien = new javax.swing.JLabel();
        cboCategory = new javax.swing.JComboBox<>();
        jLabel30 = new javax.swing.JLabel();
        jScrollPane5 = new javax.swing.JScrollPane();
        tbInfo = new javax.swing.JTable();
        jLabel31 = new javax.swing.JLabel();
        txtPhiKhac = new javax.swing.JTextField();
        jLabel32 = new javax.swing.JLabel();
        txtGiamGia = new javax.swing.JTextField();
        jLabel33 = new javax.swing.JLabel();
        cboFood = new javax.swing.JComboBox<>();
        jLabel34 = new javax.swing.JLabel();
        jLabel35 = new javax.swing.JLabel();
        lbTime = new javax.swing.JLabel();
        btnXoasp = new javax.swing.JButton();
        jLabel21 = new javax.swing.JLabel();
        lblTime = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        setTitle("PolyBilliards");
        setBackground(new java.awt.Color(255, 51, 51));
        setPreferredSize(new java.awt.Dimension(1239, 771));
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosed(java.awt.event.WindowEvent evt) {
                formWindowClosed(evt);
            }
        });

        pnlLeft.setBackground(new java.awt.Color(255, 153, 102));
        pnlLeft.setLayout(new java.awt.BorderLayout(1, 1));

        pnlLeftCenter.setBackground(new java.awt.Color(255, 255, 255));

        btnDrawerManager.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/menu/list.png"))); // NOI18N
        btnDrawerManager.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDrawerManagerActionPerformed(evt);
            }
        });

        btnDrawerUser.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/menu/list.png"))); // NOI18N
        btnDrawerUser.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDrawerUserActionPerformed(evt);
            }
        });

        btnToggleTheme.setFont(new java.awt.Font("Arial", 0, 14)); // NOI18N
        btnToggleTheme.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnToggleThemeActionPerformed(evt);
            }
        });

        jPanel10.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Khu vực liber", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Arial", 1, 18))); // NOI18N

        btnLiber10.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber10.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber10.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber10.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber10.setText("Bàn liber 10");
        btnLiber10.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber10.setName("10"); // NOI18N
        btnLiber10.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber10.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLiber10.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLiber10ActionPerformed(evt);
            }
        });

        btnLiber11.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber11.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber11.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber11.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber11.setText("Bàn liber 11");
        btnLiber11.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber11.setName("11"); // NOI18N
        btnLiber11.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber11.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLiber11.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLiber11ActionPerformed(evt);
            }
        });

        btnLiber1.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber1.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber1.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber1.setText("Bàn liber 1");
        btnLiber1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber1.setName("1"); // NOI18N
        btnLiber1.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLiber1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLiber1ActionPerformed(evt);
            }
        });

        btnLiber6.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber6.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber6.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber6.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber6.setText("Bàn liber 6");
        btnLiber6.setBorderPainted(false);
        btnLiber6.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber6.setInheritsPopupMenu(true);
        btnLiber6.setName("6"); // NOI18N
        btnLiber6.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber6.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLiber6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLiber6ActionPerformed(evt);
            }
        });

        btnLiber9.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber9.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber9.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber9.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber9.setText("Bàn liber 9");
        btnLiber9.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber9.setName("9"); // NOI18N
        btnLiber9.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber9.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);

        btnLiber12.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber12.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber12.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber12.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber12.setText("Bàn liber 12");
        btnLiber12.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber12.setMaximumSize(new java.awt.Dimension(100, 100));
        btnLiber12.setMinimumSize(new java.awt.Dimension(100, 100));
        btnLiber12.setName("12"); // NOI18N
        btnLiber12.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber12.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLiber12.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLiber12ActionPerformed(evt);
            }
        });

        btnLiber3.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber3.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber3.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber3.setText("Bàn liber 3");
        btnLiber3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber3.setName("3"); // NOI18N
        btnLiber3.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLiber3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLiber3ActionPerformed(evt);
            }
        });

        btnLiber5.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber5.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber5.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber5.setText("Bàn liber 5");
        btnLiber5.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber5.setName("5"); // NOI18N
        btnLiber5.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber5.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);

        btnLiber4.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber4.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber4.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber4.setText("Bàn liber 4");
        btnLiber4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber4.setName("4"); // NOI18N
        btnLiber4.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber4.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);

        btnLiber8.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber8.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber8.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber8.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber8.setText("Bàn liber 8");
        btnLiber8.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber8.setName("8"); // NOI18N
        btnLiber8.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber8.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);

        btnLiber2.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber2.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber2.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber2.setText("Bàn liber 2");
        btnLiber2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber2.setName("2"); // NOI18N
        btnLiber2.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLiber2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLiber2ActionPerformed(evt);
            }
        });

        btnLiber7.setBackground(new java.awt.Color(204, 204, 204));
        btnLiber7.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLiber7.setForeground(new java.awt.Color(255, 0, 51));
        btnLiber7.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLiber7.setText("Bàn liber 7");
        btnLiber7.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLiber7.setMaximumSize(new java.awt.Dimension(100, 100));
        btnLiber7.setMinimumSize(new java.awt.Dimension(100, 100));
        btnLiber7.setName("7"); // NOI18N
        btnLiber7.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLiber7.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);

        javax.swing.GroupLayout jPanel10Layout = new javax.swing.GroupLayout(jPanel10);
        jPanel10.setLayout(jPanel10Layout);
        jPanel10Layout.setHorizontalGroup(
            jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel10Layout.createSequentialGroup()
                .addGap(40, 40, 40)
                .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel10Layout.createSequentialGroup()
                        .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(btnLiber5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnLiber9, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(41, 41, 41)
                        .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(btnLiber6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnLiber2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnLiber10, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addComponent(btnLiber1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 33, Short.MAX_VALUE)
                .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(btnLiber3, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(btnLiber11, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(btnLiber7, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(44, 44, 44)
                .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(btnLiber4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLiber8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLiber12, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(50, 50, 50))
        );
        jPanel10Layout.setVerticalGroup(
            jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel10Layout.createSequentialGroup()
                .addGap(33, 33, 33)
                .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(btnLiber1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLiber2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLiber3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLiber4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel10Layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(btnLiber8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnLiber7, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnLiber6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(26, 26, 26)
                        .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(btnLiber11, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnLiber12, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(jPanel10Layout.createSequentialGroup()
                        .addComponent(btnLiber5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(btnLiber10, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnLiber9, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addGap(32, 32, 32))
        );

        jPanel11.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Khu vực bàn VIP", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Arial", 1, 18))); // NOI18N

        btnVip2.setBackground(new java.awt.Color(204, 204, 204));
        btnVip2.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnVip2.setForeground(new java.awt.Color(255, 0, 51));
        btnVip2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnVip2.setText("Bàn VIP 2");
        btnVip2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnVip2.setMaximumSize(new java.awt.Dimension(100, 100));
        btnVip2.setMinimumSize(new java.awt.Dimension(100, 100));
        btnVip2.setName("14"); // NOI18N
        btnVip2.setPreferredSize(new java.awt.Dimension(100, 100));
        btnVip2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnVip2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnVip2ActionPerformed(evt);
            }
        });

        btnVip3.setBackground(new java.awt.Color(204, 204, 204));
        btnVip3.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnVip3.setForeground(new java.awt.Color(255, 0, 51));
        btnVip3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnVip3.setText("Bàn VIP 3");
        btnVip3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnVip3.setMaximumSize(new java.awt.Dimension(100, 100));
        btnVip3.setMinimumSize(new java.awt.Dimension(100, 100));
        btnVip3.setName("15"); // NOI18N
        btnVip3.setPreferredSize(new java.awt.Dimension(100, 100));
        btnVip3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnVip3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnVip3ActionPerformed(evt);
            }
        });

        btnVip1.setBackground(new java.awt.Color(204, 204, 204));
        btnVip1.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnVip1.setForeground(new java.awt.Color(255, 0, 51));
        btnVip1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnVip1.setText("Bàn VIP 1");
        btnVip1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnVip1.setMaximumSize(new java.awt.Dimension(100, 100));
        btnVip1.setMinimumSize(new java.awt.Dimension(100, 100));
        btnVip1.setName("13"); // NOI18N
        btnVip1.setPreferredSize(new java.awt.Dimension(100, 100));
        btnVip1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnVip1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnVip1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel11Layout = new javax.swing.GroupLayout(jPanel11);
        jPanel11.setLayout(jPanel11Layout);
        jPanel11Layout.setHorizontalGroup(
            jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel11Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel11Layout.createSequentialGroup()
                        .addGap(108, 108, 108)
                        .addComponent(btnVip3, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel11Layout.createSequentialGroup()
                        .addComponent(btnVip1, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(63, 63, 63)
                        .addComponent(btnVip2, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        jPanel11Layout.setVerticalGroup(
            jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel11Layout.createSequentialGroup()
                .addContainerGap(91, Short.MAX_VALUE)
                .addGroup(jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(btnVip1, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnVip2, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(50, 50, 50)
                .addComponent(btnVip3, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(68, 68, 68))
        );

        jPanel12.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Khu vực bàn lỗ", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Arial", 1, 18))); // NOI18N

        btnLo1.setBackground(new java.awt.Color(204, 204, 204));
        btnLo1.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLo1.setForeground(new java.awt.Color(255, 0, 51));
        btnLo1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLo1.setText("Bàn lỗ 1");
        btnLo1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLo1.setName("16"); // NOI18N
        btnLo1.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLo1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLo1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLo1ActionPerformed(evt);
            }
        });

        btnLo2.setBackground(new java.awt.Color(204, 204, 204));
        btnLo2.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLo2.setForeground(new java.awt.Color(255, 0, 51));
        btnLo2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLo2.setText("Bàn lỗ 2");
        btnLo2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLo2.setName("17"); // NOI18N
        btnLo2.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLo2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLo2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLo2ActionPerformed(evt);
            }
        });

        btnLo3.setBackground(new java.awt.Color(204, 204, 204));
        btnLo3.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLo3.setForeground(new java.awt.Color(255, 0, 51));
        btnLo3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLo3.setText("Bàn lỗ 3");
        btnLo3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLo3.setMaximumSize(new java.awt.Dimension(100, 100));
        btnLo3.setMinimumSize(new java.awt.Dimension(100, 100));
        btnLo3.setName("18"); // NOI18N
        btnLo3.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLo3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLo3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLo3ActionPerformed(evt);
            }
        });

        btnLo4.setBackground(new java.awt.Color(204, 204, 204));
        btnLo4.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLo4.setForeground(new java.awt.Color(255, 0, 51));
        btnLo4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLo4.setText("Bàn lỗ 4");
        btnLo4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLo4.setMaximumSize(new java.awt.Dimension(100, 100));
        btnLo4.setMinimumSize(new java.awt.Dimension(100, 100));
        btnLo4.setName("19"); // NOI18N
        btnLo4.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLo4.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLo4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLo4ActionPerformed(evt);
            }
        });

        btnLo5.setBackground(new java.awt.Color(204, 204, 204));
        btnLo5.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnLo5.setForeground(new java.awt.Color(255, 0, 51));
        btnLo5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump-small.png"))); // NOI18N
        btnLo5.setText("Bàn lỗ 5");
        btnLo5.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnLo5.setMaximumSize(new java.awt.Dimension(100, 100));
        btnLo5.setMinimumSize(new java.awt.Dimension(100, 100));
        btnLo5.setName("20"); // NOI18N
        btnLo5.setPreferredSize(new java.awt.Dimension(100, 100));
        btnLo5.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btnLo5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLo5ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel12Layout = new javax.swing.GroupLayout(jPanel12);
        jPanel12.setLayout(jPanel12Layout);
        jPanel12Layout.setHorizontalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addComponent(btnLo1, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(52, 52, 52)
                .addComponent(btnLo2, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(63, 63, 63)
                .addComponent(btnLo3, javax.swing.GroupLayout.PREFERRED_SIZE, 155, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnLo4, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(59, 59, 59)
                .addComponent(btnLo5, javax.swing.GroupLayout.PREFERRED_SIZE, 147, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(30, 30, 30))
        );
        jPanel12Layout.setVerticalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addGap(22, 22, 22)
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btnLo5, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLo4, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLo3, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLo2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLo1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(33, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout jPanel9Layout = new javax.swing.GroupLayout(jPanel9);
        jPanel9.setLayout(jPanel9Layout);
        jPanel9Layout.setHorizontalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel9Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(jPanel12, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel9Layout.createSequentialGroup()
                        .addComponent(jPanel10, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(44, 44, 44)
                        .addComponent(jPanel11, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(132, Short.MAX_VALUE))
        );
        jPanel9Layout.setVerticalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel9Layout.createSequentialGroup()
                .addGap(12, 12, 12)
                .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel10, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel11, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jPanel12, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        tabs.addTab("Phòng bàn", jPanel9);

        txtPhiDichVu.setText("0");
        txtPhiDichVu.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtPhiDichVuFocusLost(evt);
            }
        });

        jLabel19.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel19.setText("Đồ ăn & đồ uống :");

        snpCount.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                snpCountStateChanged(evt);
            }
        });
        snpCount.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                snpCountMouseClicked(evt);
            }
        });

        btnStopContinue.setBackground(new java.awt.Color(255, 0, 0));
        btnStopContinue.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnStopContinue.setForeground(new java.awt.Color(255, 255, 255));
        btnStopContinue.setText("Dừng giờ");
        btnStopContinue.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnStopContinueActionPerformed(evt);
            }
        });

        btnThanhToan.setBackground(new java.awt.Color(255, 51, 51));
        btnThanhToan.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        btnThanhToan.setForeground(new java.awt.Color(255, 255, 255));
        btnThanhToan.setText("Thanh toán");
        btnThanhToan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnThanhToanActionPerformed(evt);
            }
        });

        btnXacNhan.setBackground(new java.awt.Color(0, 102, 102));
        btnXacNhan.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        btnXacNhan.setForeground(new java.awt.Color(255, 255, 255));
        btnXacNhan.setText("Thêm");
        btnXacNhan.setPreferredSize(new java.awt.Dimension(100, 100));
        btnXacNhan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXacNhanActionPerformed(evt);
            }
        });

        jLabel20.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel20.setText("Ghi chú :");

        btnTamTinh.setBackground(new java.awt.Color(255, 255, 51));
        btnTamTinh.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        btnTamTinh.setText("Tạm tính");
        btnTamTinh.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTamTinhActionPerformed(evt);
            }
        });

        lbTienGio.setText("0");

        jLabel22.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel22.setText("Mã hóa đơn :");

        txtTimeStart.setEditable(false);
        txtTimeStart.setBackground(new java.awt.Color(255, 255, 255));
        txtTimeStart.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        txtTimeStart.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtTimeStartFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtTimeStartFocusLost(evt);
            }
        });
        txtTimeStart.addInputMethodListener(new java.awt.event.InputMethodListener() {
            public void caretPositionChanged(java.awt.event.InputMethodEvent evt) {
            }
            public void inputMethodTextChanged(java.awt.event.InputMethodEvent evt) {
                txtTimeStartInputMethodTextChanged(evt);
            }
        });
        txtTimeStart.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtTimeStartActionPerformed(evt);
            }
        });

        lbMaHoaDon.setFont(new java.awt.Font("Segoe UI", 0, 13)); // NOI18N
        lbMaHoaDon.setText("00000");

        jLabel23.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        jLabel23.setText("Menu :");

        txtTimeStop.setEditable(false);
        txtTimeStop.setBackground(new java.awt.Color(255, 255, 255));
        txtTimeStop.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N

        jLabel24.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel24.setText("Bàn :");

        btnStart.setBackground(new java.awt.Color(0, 204, 0));
        btnStart.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnStart.setForeground(new java.awt.Color(255, 255, 255));
        btnStart.setText("Bắt đầu");
        btnStart.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnStartActionPerformed(evt);
            }
        });

        txtGhiChu.setColumns(20);
        txtGhiChu.setRows(5);
        jScrollPane4.setViewportView(txtGhiChu);

        jLabel25.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        jLabel25.setText("Thời gian bắt đầu :");

        jPanel14.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(243, 112, 33), 1, true));

        jLabel26.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/trump.png"))); // NOI18N

        javax.swing.GroupLayout jPanel14Layout = new javax.swing.GroupLayout(jPanel14);
        jPanel14.setLayout(jPanel14Layout);
        jPanel14Layout.setHorizontalGroup(
            jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel14Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel26, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        jPanel14Layout.setVerticalGroup(
            jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabel26, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        lbTable.setFont(new java.awt.Font("Segoe UI", 0, 13)); // NOI18N
        lbTable.setText("Không");

        lbDateNow.setFont(new java.awt.Font("Segoe UI", 0, 13)); // NOI18N
        lbDateNow.setText("00/00/0000");

        jLabel27.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        jLabel27.setText("Thời gian kết thúc :");

        jLabel28.setFont(new java.awt.Font("Arial", 1, 20)); // NOI18N
        jLabel28.setText("Tổng tiền :");

        jLabel29.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel29.setText("Phí dịch vụ :");

        lbTongTien.setFont(new java.awt.Font("Segoe UI Black", 1, 20)); // NOI18N
        lbTongTien.setForeground(new java.awt.Color(255, 51, 51));
        lbTongTien.setText("0");

        cboCategory.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cboCategory.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                cboCategoryItemStateChanged(evt);
            }
        });
        cboCategory.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboCategoryActionPerformed(evt);
            }
        });

        jLabel30.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel30.setText("Giảm giá :");

        tbInfo.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        tbInfo.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Tên SP", "Số lượng", "Đơn giá", "Thành tiền"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Integer.class, java.lang.Object.class, java.lang.Object.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane5.setViewportView(tbInfo);
        if (tbInfo.getColumnModel().getColumnCount() > 0) {
            tbInfo.getColumnModel().getColumn(1).setPreferredWidth(10);
        }

        jLabel31.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel31.setText("Ngày tạo hóa đơn :");

        txtPhiKhac.setText("0");
        txtPhiKhac.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtPhiKhacFocusLost(evt);
            }
        });

        jLabel32.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel32.setText("Tiền giờ :");

        txtGiamGia.setText("0");
        txtGiamGia.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtGiamGiaFocusLost(evt);
            }
        });
        txtGiamGia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtGiamGiaActionPerformed(evt);
            }
        });

        jLabel33.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel33.setText("Loại :");

        cboFood.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cboFood.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                cboFoodItemStateChanged(evt);
            }
        });
        cboFood.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                cboFoodMouseClicked(evt);
            }
        });
        cboFood.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboFoodActionPerformed(evt);
            }
        });

        jLabel34.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel34.setText("Phí khác :");

        jLabel35.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel35.setText("Tổng thời gian đã chơi :");

        lbTime.setFont(new java.awt.Font("Segoe UI", 0, 13)); // NOI18N
        lbTime.setText("00:00:00");

        btnXoasp.setBackground(new java.awt.Color(255, 51, 51));
        btnXoasp.setFont(new java.awt.Font("Arial", 1, 12)); // NOI18N
        btnXoasp.setForeground(new java.awt.Color(255, 255, 255));
        btnXoasp.setText("Xoá");
        btnXoasp.setPreferredSize(new java.awt.Dimension(100, 100));
        btnXoasp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXoaspActionPerformed(evt);
            }
        });

        jLabel21.setFont(new java.awt.Font("Arial", 0, 12)); // NOI18N
        jLabel21.setText("Đơn vị: VNĐ");

        lblTime.setFont(new java.awt.Font("Arial", 1, 16)); // NOI18N
        lblTime.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblTime.setText("Giờ là:");

        javax.swing.GroupLayout jPanel13Layout = new javax.swing.GroupLayout(jPanel13);
        jPanel13.setLayout(jPanel13Layout);
        jPanel13Layout.setHorizontalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jSeparator3, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jSeparator8))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED))
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jSeparator7)
                            .addComponent(jSeparator6, javax.swing.GroupLayout.PREFERRED_SIZE, 1, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 32, Short.MAX_VALUE)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel13Layout.createSequentialGroup()
                                        .addGap(1, 1, 1)
                                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                            .addComponent(jLabel33)
                                            .addComponent(jLabel19))
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(cboFood, javax.swing.GroupLayout.PREFERRED_SIZE, 247, javax.swing.GroupLayout.PREFERRED_SIZE)
                                            .addComponent(cboCategory, javax.swing.GroupLayout.PREFERRED_SIZE, 247, javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addComponent(snpCount, javax.swing.GroupLayout.PREFERRED_SIZE, 79, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGap(9, 9, 9)
                                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(btnXacNhan, javax.swing.GroupLayout.PREFERRED_SIZE, 112, javax.swing.GroupLayout.PREFERRED_SIZE)
                                            .addComponent(btnXoasp, javax.swing.GroupLayout.PREFERRED_SIZE, 113, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                    .addGroup(jPanel13Layout.createSequentialGroup()
                                        .addComponent(jPanel14, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGap(26, 26, 26)
                                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                            .addGroup(jPanel13Layout.createSequentialGroup()
                                                .addGap(62, 62, 62)
                                                .addComponent(btnStart)
                                                .addGap(18, 18, 18)
                                                .addComponent(btnStopContinue))
                                            .addGroup(jPanel13Layout.createSequentialGroup()
                                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                                    .addComponent(jLabel27, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                    .addComponent(jLabel25, javax.swing.GroupLayout.PREFERRED_SIZE, 117, javax.swing.GroupLayout.PREFERRED_SIZE))
                                                .addGap(18, 18, 18)
                                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                    .addComponent(txtTimeStart)
                                                    .addComponent(txtTimeStop)))
                                            .addComponent(lblTime, javax.swing.GroupLayout.PREFERRED_SIZE, 318, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                    .addComponent(jLabel23))
                                .addGap(29, 29, 29))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addGroup(jPanel13Layout.createSequentialGroup()
                                        .addComponent(jLabel28)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(lbTongTien, javax.swing.GroupLayout.PREFERRED_SIZE, 237, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addGroup(jPanel13Layout.createSequentialGroup()
                                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                            .addComponent(jLabel29)
                                            .addComponent(jLabel32))
                                        .addGap(18, 18, 18)
                                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                            .addComponent(jLabel21)
                                            .addGroup(jPanel13Layout.createSequentialGroup()
                                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                                    .addGroup(jPanel13Layout.createSequentialGroup()
                                                        .addComponent(txtPhiDichVu, javax.swing.GroupLayout.PREFERRED_SIZE, 146, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addGap(12, 12, 12)
                                                        .addComponent(jLabel34))
                                                    .addGroup(jPanel13Layout.createSequentialGroup()
                                                        .addComponent(lbTienGio, javax.swing.GroupLayout.PREFERRED_SIZE, 137, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                        .addComponent(jLabel30)))
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                                    .addComponent(txtGiamGia)
                                                    .addComponent(txtPhiKhac, javax.swing.GroupLayout.PREFERRED_SIZE, 146, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                                    .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addGroup(jPanel13Layout.createSequentialGroup()
                                            .addComponent(btnTamTinh, javax.swing.GroupLayout.PREFERRED_SIZE, 176, javax.swing.GroupLayout.PREFERRED_SIZE)
                                            .addGap(65, 65, 65)
                                            .addComponent(btnThanhToan, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addGroup(jPanel13Layout.createSequentialGroup()
                                            .addComponent(jLabel20)
                                            .addGap(18, 18, 18)
                                            .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 378, javax.swing.GroupLayout.PREFERRED_SIZE))))
                                .addGap(78, 78, 78)))))
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGap(1, 1, 1)
                        .addComponent(jLabel31)
                        .addGap(53, 53, 53)
                        .addComponent(lbDateNow))
                    .addComponent(jLabel22)
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel24)
                            .addComponent(jLabel35))
                        .addGap(18, 18, 18)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lbMaHoaDon)
                            .addComponent(lbTime)
                            .addComponent(lbTable, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addComponent(jScrollPane5, javax.swing.GroupLayout.PREFERRED_SIZE, 524, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        jPanel13Layout.setVerticalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel13Layout.createSequentialGroup()
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(jSeparator6, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(30, 30, 30))
                            .addGroup(jPanel13Layout.createSequentialGroup()
                                .addGap(20, 20, 20)
                                .addComponent(lblTime, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                        .addComponent(jSeparator8, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel13Layout.createSequentialGroup()
                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addGroup(jPanel13Layout.createSequentialGroup()
                                        .addComponent(jLabel23)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED))
                                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                                        .addGap(12, 12, 12)
                                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                                                .addComponent(btnXacNhan, javax.swing.GroupLayout.PREFERRED_SIZE, 36, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(18, 18, 18))
                                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel13Layout.createSequentialGroup()
                                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                    .addComponent(cboCategory, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                    .addComponent(jLabel33))
                                                .addGap(18, 18, 18)))))
                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(cboFood, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel19)
                                    .addComponent(btnXoasp, javax.swing.GroupLayout.PREFERRED_SIZE, 36, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(jPanel13Layout.createSequentialGroup()
                                .addGap(47, 47, 47)
                                .addComponent(snpCount, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(18, 18, 18)
                        .addComponent(jSeparator3, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addComponent(jPanel14, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(177, 177, 177)))
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jSeparator7, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel21)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel13Layout.createSequentialGroup()
                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel32)
                                    .addComponent(lbTienGio)
                                    .addComponent(txtGiamGia, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel30))
                                .addGap(9, 9, 9)
                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel29)
                                    .addComponent(txtPhiDichVu, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(jPanel13Layout.createSequentialGroup()
                                .addGap(34, 34, 34)
                                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(txtPhiKhac, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel34))))
                        .addGap(18, 18, 18)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel20)
                            .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 64, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 25, Short.MAX_VALUE)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel28)
                            .addComponent(lbTongTien, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnThanhToan, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnTamTinh, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(33, 33, 33))))
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addGap(14, 14, 14)
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbDateNow)
                    .addComponent(jLabel31))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel22)
                    .addComponent(lbMaHoaDon))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGap(75, 75, 75)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnStart)
                            .addComponent(btnStopContinue)))
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtTimeStart, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel25))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtTimeStop, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel27)))
                    .addGroup(jPanel13Layout.createSequentialGroup()
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel24)
                            .addComponent(lbTable))
                        .addGap(13, 13, 13)
                        .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel35)
                            .addComponent(lbTime))
                        .addGap(18, 18, 18)
                        .addComponent(jScrollPane5, javax.swing.GroupLayout.PREFERRED_SIZE, 529, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        tabs.addTab("Thực đơn", jPanel13);

        javax.swing.GroupLayout pnlLeftCenterLayout = new javax.swing.GroupLayout(pnlLeftCenter);
        pnlLeftCenter.setLayout(pnlLeftCenterLayout);
        pnlLeftCenterLayout.setHorizontalGroup(
            pnlLeftCenterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlLeftCenterLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnlLeftCenterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(btnDrawerUser, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btnToggleTheme, javax.swing.GroupLayout.PREFERRED_SIZE, 44, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnDrawerManager, javax.swing.GroupLayout.PREFERRED_SIZE, 44, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(tabs))
        );
        pnlLeftCenterLayout.setVerticalGroup(
            pnlLeftCenterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlLeftCenterLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(btnDrawerManager)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnDrawerUser)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnToggleTheme, javax.swing.GroupLayout.PREFERRED_SIZE, 36, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(pnlLeftCenterLayout.createSequentialGroup()
                .addComponent(tabs, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );

        pnlLeft.add(pnlLeftCenter, java.awt.BorderLayout.CENTER);

        getContentPane().add(pnlLeft, java.awt.BorderLayout.LINE_START);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void formWindowClosed(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed
        // TODO add your handling code here:
        // Bỏ this.exit() để không hiển thị dialog confirm
        // this.exit();
    }//GEN-LAST:event_formWindowClosed

    private void btnLiber10ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLiber10ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLiber10ActionPerformed

    private void btnLiber11ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLiber11ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLiber11ActionPerformed

    private void btnLiber1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLiber1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLiber1ActionPerformed

    private void btnLiber6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLiber6ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLiber6ActionPerformed

    private void btnLiber12ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLiber12ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLiber12ActionPerformed

    private void btnVip2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnVip2ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnVip2ActionPerformed

    private void btnVip3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnVip3ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnVip3ActionPerformed

    private void btnVip1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnVip1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnVip1ActionPerformed

    private void btnLo1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLo1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLo1ActionPerformed

    private void btnLo2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLo2ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLo2ActionPerformed

    private void btnLo3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLo3ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLo3ActionPerformed

    private void btnLo4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLo4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLo4ActionPerformed

    private void btnLo5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLo5ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLo5ActionPerformed

    private void txtPhiDichVuFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtPhiDichVuFocusLost
        // TODO add your handling code here:
        calTotalPice();
    }//GEN-LAST:event_txtPhiDichVuFocusLost

    private void snpCountStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_snpCountStateChanged
        // TODO add your handling code here:
    }//GEN-LAST:event_snpCountStateChanged

    private void snpCountMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_snpCountMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_snpCountMouseClicked

    private void btnStopContinueActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnStopContinueActionPerformed
        // TODO add your handling code here:
        if (idtable <= 0) {
            XDialog.alert(this, "Chưa chọn bàn chơi !");
            return;
        }
        if (txtTimeStart.getText().equals("")) {
            XDialog.alert(this, "Chưa có thời gian bắt đầu");
            return;
        }

        // Kiểm tra trạng thái hiện tại để quyết định hành động
        if (!isPaused) {
            // Đang chạy → Dừng
            pauseGame();
            calTotalPice();
        } else {
            // Đã dừng → Tiếp tục
            resumeGame();
        }
    }//GEN-LAST:event_btnStopContinueActionPerformed

    private void btnThanhToanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnThanhToanActionPerformed
        // TODO add your handling code here:
        if (txtTimeStart.getText().equals("")) {
            XDialog.alert(this, "Chưa bắt đầu");
            return;
        }
        if (txtTimeStop.getText().equals("")) {
            XDialog.alert(this, "Chưa dừng giờ");
        } else {
            if (XDialog.confirm(this, "Bạn muốn thanh toán bàn này?")) {
                // Chỉ gọi clickThanhToan(), không gọi updateBill() riêng
                clickThanhToan();
                XDialog.info(this, "ĐÃ THANH TOÁN");
                btnStart.setEnabled(true);
            }
        }
    }//GEN-LAST:event_btnThanhToanActionPerformed

    private void btnXacNhanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXacNhanActionPerformed
        // TODO add your handling code here:
        System.out.println("=== NÚT XÁC NHẬN ĐƯỢC NHẤN ===");
        System.out.println("txtTimeStart.getText(): '" + txtTimeStart.getText() + "'");

        if (txtTimeStart.getText().equals("")) {
            System.out.println("Chưa bắt đầu giờ - không thực hiện insertBillinfo()");
            XDialog.alert(this, "Chưa bắt đầu giờ");
            return;
        }

        System.out.println("Điều kiện OK - gọi insertBillinfo()");
        this.insertBillinfo();
        this.calTotalPice();
        System.out.println("=== KẾT THÚC NÚT XÁC NHẬN ===");
    }//GEN-LAST:event_btnXacNhanActionPerformed

    private void btnTamTinhActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTamTinhActionPerformed
        // TODO add your handling code here:
        this.billTamTinh();
    }//GEN-LAST:event_btnTamTinhActionPerformed

    private void txtTimeStartFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtTimeStartFocusGained
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTimeStartFocusGained

    private void txtTimeStartFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtTimeStartFocusLost
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTimeStartFocusLost

    private void txtTimeStartInputMethodTextChanged(java.awt.event.InputMethodEvent evt) {//GEN-FIRST:event_txtTimeStartInputMethodTextChanged
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTimeStartInputMethodTextChanged

    private void txtTimeStartActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtTimeStartActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTimeStartActionPerformed

    private void btnStartActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnStartActionPerformed
        // TODO add your handling code here:
        if (idtable <= 0) {
            XDialog.alert(this, "Chưa chọn bàn chơi !");
            return;
        }
        this.insertBill();
        btnStart.setEnabled(false);
        btnStopContinue.setEnabled(true);

        // Bắt đầu theo dõi thời gian chơi
        startPlayTime();
    }//GEN-LAST:event_btnStartActionPerformed

    private void cboCategoryItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_cboCategoryItemStateChanged
        // TODO add your handling code here:
        if (evt.getStateChange() == ItemEvent.SELECTED) {
            this.dataCboFood();
        }
    }//GEN-LAST:event_cboCategoryItemStateChanged

    private void cboCategoryActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboCategoryActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboCategoryActionPerformed

    private void txtPhiKhacFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtPhiKhacFocusLost
        // TODO add your handling code here:
    }//GEN-LAST:event_txtPhiKhacFocusLost

    private void txtGiamGiaFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtGiamGiaFocusLost
        // TODO add your handling code here:
        calTotalPice();
    }//GEN-LAST:event_txtGiamGiaFocusLost

    private void cboFoodItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_cboFoodItemStateChanged
        // TODO add your handling code here:
        if (evt.getStateChange() == ItemEvent.SELECTED) {
            this.showIdFood();
        }
    }//GEN-LAST:event_cboFoodItemStateChanged

    private void cboFoodMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cboFoodMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_cboFoodMouseClicked

    private void cboFoodActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboFoodActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboFoodActionPerformed

    private void txtGiamGiaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtGiamGiaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtGiamGiaActionPerformed

    private void btnXoaspActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXoaspActionPerformed
        // TODO add your handling code here:
        int selectedRow = tbInfo.getSelectedRow();
        if (selectedRow >= 0) {
            // Lấy thông tin sản phẩm được chọn
            String productName = (String) tbInfo.getValueAt(selectedRow, 0);
            int currentQuantity = (Integer) tbInfo.getValueAt(selectedRow, 1);
            float unitPrice = (Float) tbInfo.getValueAt(selectedRow, 2);

            if (currentQuantity > 1) {
                // Nếu số lượng > 1, hiện dialog nhập số lượng cần xóa
                String input = XDialog.prompt(this,
                        "Nhập số lượng cần xóa.\nSố lượng hiện có: " + currentQuantity);

                if (input != null && !input.trim().isEmpty()) {
                    try {
                        int quantityToRemove = Integer.parseInt(input.trim());

                        // Kiểm tra số lượng nhập vào
                        if (quantityToRemove <= 0) {
                            XDialog.alert(this, "Số lượng phải lớn hơn 0!");
                            return;
                        }

                        if (quantityToRemove > currentQuantity) {
                            XDialog.alert(this, "Số lượng xóa không được lớn hơn số lượng hiện có!");
                            return;
                        }

                        // Xử lý xóa số lượng
                        if (quantityToRemove == currentQuantity) {
                            // Xóa toàn bộ sản phẩm
                            modelTable = (DefaultTableModel) tbInfo.getModel();
                            modelTable.removeRow(selectedRow);

                            // Xóa trong database
                            try {
                                String foodId = showIdFood(); // Lấy ID của sản phẩm được chọn
                                if (foodId != null) {
                                    billifdao.deleteByBillIdAndFoodId(showIdBill(), foodId);
                                }
                            } catch (Exception e) {
                                e.printStackTrace();
                            }

                            XDialog.info(this, "Đã xóa toàn bộ " + productName + " khỏi hóa đơn!");
                        } else {
                            // Giảm số lượng
                            int newQuantity = currentQuantity - quantityToRemove;
                            float newTotalPrice = newQuantity * unitPrice;

                            // Cập nhật trên bảng
                            tbInfo.setValueAt(newQuantity, selectedRow, 1);
                            tbInfo.setValueAt(newTotalPrice, selectedRow, 3);

                            // Cập nhật trong database
                            try {
                                String foodId = showIdFood(); // Lấy ID của sản phẩm được chọn
                                if (foodId != null) {
                                    billifdao.updateCountByBillIdAndFoodId(showIdBill(), foodId, newQuantity);
                                }
                            } catch (Exception e) {
                                e.printStackTrace();
                            }

                            XDialog.info(this, "Đã xóa " + quantityToRemove + " " + productName + " khỏi hóa đơn!");
                        }

                        // Tính lại tổng tiền
                        calTotalPice();

                    } catch (NumberFormatException e) {
                        XDialog.alert(this, "Vui lòng nhập số hợp lệ!");
                    }
                }
            } else {
                // Nếu số lượng = 1, xóa toàn bộ sản phẩm
                if (XDialog.confirm(this, "Bạn có muốn xóa sản phẩm này khỏi hóa đơn?")) {
                    modelTable = (DefaultTableModel) tbInfo.getModel();
                    modelTable.removeRow(selectedRow);

                    // Xóa trong database
                    try {
                        String foodId = showIdFood(); // Lấy ID của sản phẩm được chọn
                        if (foodId != null) {
                            billifdao.deleteByBillIdAndFoodId(showIdBill(), foodId);
                        }
                    } catch (Exception e) {
                        e.printStackTrace();
                    }

                    // Tính lại tổng tiền
                    calTotalPice();

                    XDialog.info(this, "Đã xóa sản phẩm khỏi hóa đơn!");
                }
            }
        } else {
            XDialog.alert(this, "Vui lòng chọn sản phẩm cần xóa!");
        }
    }//GEN-LAST:event_btnXoaspActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(PolyBilliardsJFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(PolyBilliardsJFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(PolyBilliardsJFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(PolyBilliardsJFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                LoginJDialog loginDialog = new LoginJDialog(new javax.swing.JDialog(), true);
                loginDialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                loginDialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnDrawerManager;
    private javax.swing.JButton btnDrawerUser;
    private javax.swing.JButton btnLiber1;
    private javax.swing.JButton btnLiber10;
    private javax.swing.JButton btnLiber11;
    private javax.swing.JButton btnLiber12;
    private javax.swing.JButton btnLiber2;
    private javax.swing.JButton btnLiber3;
    private javax.swing.JButton btnLiber4;
    private javax.swing.JButton btnLiber5;
    private javax.swing.JButton btnLiber6;
    private javax.swing.JButton btnLiber7;
    private javax.swing.JButton btnLiber8;
    private javax.swing.JButton btnLiber9;
    private javax.swing.JButton btnLo1;
    private javax.swing.JButton btnLo2;
    private javax.swing.JButton btnLo3;
    private javax.swing.JButton btnLo4;
    private javax.swing.JButton btnLo5;
    private javax.swing.JButton btnStart;
    private javax.swing.JButton btnStopContinue;
    private javax.swing.JButton btnTamTinh;
    private javax.swing.JButton btnThanhToan;
    private javax.swing.JButton btnToggleTheme;
    private javax.swing.JButton btnVip1;
    private javax.swing.JButton btnVip2;
    private javax.swing.JButton btnVip3;
    private javax.swing.JButton btnXacNhan;
    private javax.swing.JButton btnXoasp;
    private javax.swing.JComboBox<String> cboCategory;
    private javax.swing.JComboBox<String> cboFood;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel20;
    private javax.swing.JLabel jLabel21;
    private javax.swing.JLabel jLabel22;
    private javax.swing.JLabel jLabel23;
    private javax.swing.JLabel jLabel24;
    private javax.swing.JLabel jLabel25;
    private javax.swing.JLabel jLabel26;
    private javax.swing.JLabel jLabel27;
    private javax.swing.JLabel jLabel28;
    private javax.swing.JLabel jLabel29;
    private javax.swing.JLabel jLabel30;
    private javax.swing.JLabel jLabel31;
    private javax.swing.JLabel jLabel32;
    private javax.swing.JLabel jLabel33;
    private javax.swing.JLabel jLabel34;
    private javax.swing.JLabel jLabel35;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel13;
    private javax.swing.JPanel jPanel14;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JSeparator jSeparator3;
    private javax.swing.JSeparator jSeparator6;
    private javax.swing.JSeparator jSeparator7;
    private javax.swing.JSeparator jSeparator8;
    private javax.swing.JLabel lbDateNow;
    private javax.swing.JLabel lbMaHoaDon;
    private javax.swing.JLabel lbTable;
    private javax.swing.JLabel lbTienGio;
    private javax.swing.JLabel lbTime;
    private javax.swing.JLabel lbTongTien;
    private javax.swing.JLabel lblTime;
    private javax.swing.JPanel pnlLeft;
    private javax.swing.JPanel pnlLeftCenter;
    private javax.swing.JSpinner snpCount;
    private javax.swing.JTabbedPane tabs;
    private javax.swing.JTable tbInfo;
    private javax.swing.JTextArea txtGhiChu;
    private javax.swing.JTextField txtGiamGia;
    private javax.swing.JTextField txtPhiDichVu;
    private javax.swing.JTextField txtPhiKhac;
    private javax.swing.JTextField txtTimeStart;
    private javax.swing.JTextField txtTimeStop;
    // End of variables declaration//GEN-END:variables

    @Override
    public void init() {
        // Apply FlatLaf by default
        XUI.setupUI(this);

        // Disable window resizing and maximize button
        this.setResizable(false);

        this.setIconImage(XIcon.getIcon("trump-small.png").getImage());
        this.setLocationRelativeTo(null);

        // Always show welcome dialog
        WelcomeJDialog welcomeDialog = new WelcomeJDialog(this, true);
        welcomeDialog.setVisible(true);

        // Only show login dialog if no user is logged in
        if (currentUser == null) {
            LoginJDialog loginDialog = new LoginJDialog(new javax.swing.JDialog(), true);
            loginDialog.setVisible(true);
        } else {
            if (!currentUser.isManager()) {
                btnDrawerManager.setVisible(false);
                btnDrawerUser.setVisible(true);
            } else {
                btnDrawerManager.setVisible(true);
                btnDrawerUser.setVisible(false);
            }
            // Initialize drawer for current user
            initializeDrawerForUser();
        }

        // Set panel colors based on theme
        XUI.setPanelPadding(pnlLeft, 0, 0, 0, 0);
        XUI.setPanelPadding(pnlLeftCenter, 0, 0, 0, 0);
//        XUI.setPanelPadding(pnlManager, 0, 0, 0, 0);

        // Customize theme toggle button
        updateThemeButtonText();

        // Set hand cursor for all buttons
        XUI.setHandCursor(this);

        hourlyRateCalculator = new XHourlyRateCalculator();
        snpCount.setValue(1);
        setlbDateNow();
        dataCboCategory();
        eventAction();
        clickTable(); // Gọi clickTable() để gán ActionListener cho tất cả button bàn

        // Khởi tạo timer cho thời gian chơi
        initPlayTimeTimer();
        
        // Set fixed colors for specific components
        txtTimeStart.setForeground(Color.BLACK);
        txtTimeStop.setForeground(Color.BLACK);
        btnTamTinh.setForeground(Color.BLACK);
    }

    private void updateThemeButtonText() {
        if (XUI.isDarkMode()) {
            btnToggleTheme.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/menu/crescent-moon.png")));
        } else {
            btnToggleTheme.setIcon(new javax.swing.ImageIcon(getClass().getResource("/poly/billiards/icons/menu/sun.png")));
        }
    }

    private void updateTime() {
        java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat("HH:mm:ss - dd/MM/yyyy");
        lblTime.setText("Giờ là: " + sdf.format(new java.util.Date()));
    }

    // Thêm phương thức để cập nhật thời gian chơi
    private void updatePlayTime() {
        if (!isPlaying || isPaused) {
            return; // Không cập nhật khi dừng
        }

        if (startTime > 0) {
            long currentTime = System.currentTimeMillis();
            long elapsedTime = currentTime - startTime - totalPausedTime;

            // Chuyển đổi milliseconds thành giờ:phút:giây
            long hours = elapsedTime / (1000 * 60 * 60);
            long minutes = (elapsedTime % (1000 * 60 * 60)) / (1000 * 60);
            long seconds = (elapsedTime % (1000 * 60)) / 1000;

            String timeString = String.format("%02d:%02d:%02d", hours, minutes, seconds);
            lbTime.setText(timeString);
        }
    }

    // Khởi tạo timer cho thời gian chơi
    private void initPlayTimeTimer() {
        playTimeTimer = new javax.swing.Timer(1000, e -> updatePlayTime());
    }

    // Bắt đầu theo dõi thời gian chơi
    private void startPlayTime() {
        if (!isPaused) {
            // Bắt đầu mới
            startTime = System.currentTimeMillis();
            totalPausedTime = 0;
        }
        // Nếu đang pause, không reset startTime

        isPlaying = true;
        if (playTimeTimer != null) {
            playTimeTimer.start();
        }
    }

    // Dừng theo dõi thời gian chơi
    private void stopPlayTime() {
        isPlaying = false;
        if (playTimeTimer != null) {
            playTimeTimer.stop();
        }
    }

    // Reset thời gian chơi
    private void resetPlayTime() {
        stopPlayTime();
        startTime = 0;
        isPaused = false;
        totalPausedTime = 0;
        pauseTime = 0;
        lbTime.setText("00:00:00");
        txtTimeStop.setText("");

        // Reset UI
        btnStopContinue.setText("Dừng giờ");
        btnStopContinue.setBackground(new Color(255, 0, 0));
    }

    private void pauseGame() {
        isPaused = true;
        pauseTime = System.currentTimeMillis();

        // Dừng timer
        if (playTimeTimer != null) {
            playTimeTimer.stop();
        }

        // Cập nhật UI
        btnStopContinue.setText("Tiếp tục");
        btnStopContinue.setBackground(new Color(0, 102, 102));

        // Hiển thị thời gian dừng theo định dạng mới
        txtTimeStop.setText(XDateHelper.stringsnowFormatted());
    }

    private void resumeGame() {
        isPaused = false;

        // Tính tổng thời gian đã dừng
        long currentTime = System.currentTimeMillis();
        totalPausedTime += (currentTime - pauseTime);

        // KHÔNG cập nhật startTime - để nguyên như cũ
        // Khởi động lại timer
        if (playTimeTimer != null) {
            playTimeTimer.start();
        }

        // Cập nhật UI
        btnStopContinue.setText("Dừng giờ");
        btnStopContinue.setBackground(new Color(255, 0, 0)); // Màu mặc định

        // Xóa thời gian dừng
        txtTimeStop.setText("");
    }

    /*--------Quản lý bàn---------*/
    private void selectTabs() {
        tabs.setSelectedIndex(1);
    }

    private void dataCboCategory() {
        DefaultComboBoxModel cboModel = (DefaultComboBoxModel) cboCategory.getModel();
        cboModel.removeAllElements();
        try {
            List<FoodCategory> list = fcatedao.findAll();
            for (FoodCategory f : list) {
                cboModel.addElement(f.getName());
            }
            dataCboFood();
        } catch (Exception e) {
            e.printStackTrace();
            XDialog.alert(this, "Lỗi!");
        }
    }

    private void dataCboFood() {
        DefaultComboBoxModel cboModel = (DefaultComboBoxModel) cboFood.getModel();
        cboModel.removeAllElements();
        try {
            int id = cboCategory.getSelectedIndex();
            if (id >= 0) {
                // Lấy đối tượng FoodCategory theo chỉ số được chọn
                FoodCategory selectedCategory = fcatedao.findAll().get(id);
                // Truyền id (kiểu String) vào findByCategoryId
                List<Food> listfood = fdao.findByCategoryId(selectedCategory.getId());
                for (Food f : listfood) {
                    cboModel.addElement(f);
                }
            } else {
                System.out.println("No");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /**
     * Refresh dữ liệu combo box khi có thay đổi
     */
    public void refreshComboData() {
        dataCboCategory();
    }

    /**
     * Implement phương thức từ DataChangeListener Được gọi khi dữ liệu thay đổi
     * từ các dialog quản lý
     */
    @Override
    public void onDataChanged() {
        refreshComboData();
    }

    private void clickTable() {
        ActionListener buttonls = new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                clickbt = (JButton) e.getSource();
                idtable = Integer.parseInt(clickbt.getName());

                // Kiểm tra trạng thái bàn trước khi cho phép sử dụng
                if (!checkTableStatus()) {
                    return; // Dừng lại nếu bàn không khả dụng
                }
                btnXacNhan.setEnabled(true);
                btnXoasp.setEnabled(true);
                btnThanhToan.setEnabled(true);
                btnTamTinh.setEnabled(true);
                clearBill();
                loadDataonTable();
                calTotalPice();
                selectTabs();
                lbTable.setText(clickbt.getText());
            }
        };
        btnLiber10.addActionListener(buttonls);
        btnLiber11.addActionListener(buttonls);
        btnLiber1.addActionListener(buttonls);
        btnLiber6.addActionListener(buttonls);
        btnLiber9.addActionListener(buttonls);
        btnLiber12.addActionListener(buttonls);
        btnLiber3.addActionListener(buttonls);
        btnLiber5.addActionListener(buttonls);
        btnLiber4.addActionListener(buttonls);
        btnLiber8.addActionListener(buttonls);
        btnLiber2.addActionListener(buttonls);
        btnLiber7.addActionListener(buttonls);
        btnVip2.addActionListener(buttonls);
        btnVip3.addActionListener(buttonls);
        btnVip1.addActionListener(buttonls);
        btnLo1.addActionListener(buttonls);
        btnLo2.addActionListener(buttonls);
        btnLo3.addActionListener(buttonls);
        btnLo4.addActionListener(buttonls);
        btnLo5.addActionListener(buttonls);
    }

    /**
     * Kiểm tra trạng thái bàn trước khi cho phép sử dụng
     *
     * @return true nếu bàn có thể sử dụng, false nếu không
     */
    private boolean checkTableStatus() {
        try {
            TableDAO tableDAO = new TableDAOImpl();
            Table table = tableDAO.findById(idtable);

            if (table == null) {
                XDialog.alert(this, "Không tìm thấy thông tin bàn!");
                return false;
            }

            String status = table.getStatus();
            if (status == null) {
                status = "";
            }

            // Chỉ chặn bàn đang bảo trì
            if (status.equalsIgnoreCase("Đang bảo trì") || status.equalsIgnoreCase("Dang bao tri")) {
                String message = table.getName() + " hiện tại đang bảo trì!\n";
                message += "Bàn đang được bảo trì, vui lòng chọn bàn khác.";

                XDialog.alert(this, message);
                return false;
            }

            return true;
        } catch (Exception e) {
            XDialog.alert(this, "Lỗi kiểm tra trạng thái bàn: " + e.getMessage());
            return false;
        }
    }

    //set lbDateNow
    private void setlbDateNow() {
        Date datenow = XDateHelper.now();
        lbDateNow.setText(XDateHelper.toString(datenow, "yyyy-MM-dd"));
    }

    //updatelbTienGio
    private void updatelbTienGio() {
        lbTienGio.setText(formatCurrency(hourlyRateCalculator.getTotalAmount()));
    }

    // Helper method để format currency không có phần thập phân
    private String formatCurrency(float amount) {
        return String.format("%.0f", amount);
    }

    // Thêm hàm parse ngược an toàn
    private float parseCurrency(String currencyString) {
        try {
            // Loại bỏ các ký tự không phải số
            String cleanString = currencyString.replaceAll("[^0-9.-]", "");
            return Float.parseFloat(cleanString);
        } catch (NumberFormatException e) {
            System.err.println("Lỗi parse currency: " + currencyString);
            return 0.0f;
        }
    }

    //showIdFood
    private String showIdFood() {
        String idfood = null;
        try {
            Food food = (Food) cboFood.getSelectedItem();
            if (food != null) {
                idfood = food.getId();
            } else {
                System.out.println("Select food is null");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return idfood;
    }

    //ShowidBill
    private int showIdBill() {
        int idbill = 0;
        try {
            Integer idbillObject = billdao.findbyIdBill(idtable);
            if (idbillObject != null) {
                idbill = idbillObject.intValue();
                System.out.println(idbill);
                return idbill;
            } else {
                return 0;

            }
        } catch (Exception e) {
            e.printStackTrace();
        }

        return idbill;
    }

    //Clear Bill
    private void clearBill() {
        txtTimeStart.setText("");
        txtTimeStop.setText("");
        txtPhiDichVu.setText("0");
        txtPhiKhac.setText("0");
        txtGiamGia.setText("0");
        txtGhiChu.setText("");
        lbTongTien.setText("0");
        lbTienGio.setText("0");
        lbMaHoaDon.setText("");
        snpCount.setValue(1);
        modelTable = (DefaultTableModel) tbInfo.getModel();
        modelTable.setRowCount(0);
        btnStart.setEnabled(true);
        btnStopContinue.setEnabled(false);

        // Reset thời gian chơi
        resetPlayTime();
    }

    //getBill
    private Bill getBill() {
        Bill model = new Bill();

        // Sửa: Parse từ định dạng hiển thị về Date cho DateCheckin
        String displayTimeStart = txtTimeStart.getText();
        if (displayTimeStart != null && !displayTimeStart.trim().isEmpty()) {
            try {
                // Parse từ định dạng "HH:mm:ss - dd/MM/yyyy" về Date
                SimpleDateFormat displayFormat = new SimpleDateFormat("HH:mm:ss - dd/MM/yyyy");
                Date checkinDate = displayFormat.parse(displayTimeStart);
                model.setDatecheckin(checkinDate);
            } catch (Exception e) {
                // Fallback: sử dụng định dạng cũ nếu có lỗi
                model.setDatecheckin(XDateHelper.toDate(txtTimeStart.getText()));
            }
        }

        // Sửa: Parse từ định dạng hiển thị về Date cho DateCheckout
        if (txtTimeStop.getText().equals("")) {
            model.setDatecheckout(XDateHelper.toDate(null));
        } else {
            String displayTimeStop = txtTimeStop.getText();
            try {
                // Parse từ định dạng "HH:mm:ss - dd/MM/yyyy" về Date
                SimpleDateFormat displayFormat = new SimpleDateFormat("HH:mm:ss - dd/MM/yyyy");
                Date checkoutDate = displayFormat.parse(displayTimeStop);
                model.setDatecheckout(checkoutDate);
            } catch (Exception e) {
                // Fallback: sử dụng định dạng cũ nếu có lỗi
                model.setDatecheckout(XDateHelper.toDate(txtTimeStop.getText()));
            }
        }

        model.setIdtable(idtable);
        model.setTableName(lbTable.getText());
        return model;
    }

    //getBillInfo
    private Billinfo getBillIfno() {
        count = (int) snpCount.getValue();
        Billinfo model = new Billinfo();

        int billId = showIdBill();
        String foodId = showIdFood();

        System.out.println("getBillIfno() - Bill ID: " + billId + ", Food ID: " + foodId + ", Count: " + count);

        model.setIdbill(billId);
        model.setIdfood(foodId); // Giữ nguyên String
        model.setCount(count);

        // Thêm thông tin từ Food được chọn
        Food selectedFood = (Food) cboFood.getSelectedItem();
        if (selectedFood != null) {
            model.setFoodName(selectedFood.getName());
            model.setDiscount(selectedFood.getDiscount());
            model.setUnitPrice(selectedFood.getUnitPrice());
            System.out.println("Food được chọn: " + selectedFood.getName() + ", Price: " + selectedFood.getUnitPrice());
        }

        // Thêm thông tin từ các trường khác
        model.setHourlyRate(parseCurrency(lbTienGio.getText()));
        model.setDiscountAmount(parseCurrency(txtGiamGia.getText()));
        model.setServiceFee(parseCurrency(txtPhiDichVu.getText()));
        model.setOtherFee(parseCurrency(txtPhiKhac.getText()));
        model.setNotes(txtGhiChu.getText());

        System.out.println("Billinfo được tạo với thông tin:");
        System.out.println("- Bill ID: " + model.getIdbill());
        System.out.println("- Food ID: " + model.getIdfood());
        System.out.println("- Food Name: " + model.getFoodName());
        System.out.println("- Count: " + model.getCount());
        System.out.println("- Unit Price: " + model.getUnitPrice());

        return model;
    }

    //insert Billinfo
    private void insertBillinfo() {
        System.out.println("=== BẮT ĐẦU INSERT BILLINFO ===");
        Billinfo billinfo = getBillIfno();
        System.out.println("Billinfo được tạo với ID Bill: " + billinfo.getIdbill());
        System.out.println("Food ID: " + billinfo.getIdfood() + ", Food Name: " + billinfo.getFoodName());

        try {
            // Kiểm tra xem đồ ăn đã có trong bảng chưa
            Food selectedFood = (Food) cboFood.getSelectedItem();
            if (selectedFood == null) {
                System.out.println("Không có đồ ăn được chọn!");
                XDialog.alert(this, "Vui lòng chọn đồ ăn!");
                return;
            }

            String selectedFoodName = selectedFood.getName();
            System.out.println("Đồ ăn được chọn: " + selectedFoodName);
            boolean foodExists = false;
            int existingRowIndex = -1;

            // Tìm kiếm trong bảng hiện tại
            System.out.println("Số dòng trong bảng: " + tbInfo.getRowCount());
            for (int i = 0; i < tbInfo.getRowCount(); i++) {
                Object tableValue = tbInfo.getValueAt(i, 0);
                String tableFoodName = null;

                // Xử lý cả trường hợp tableValue là Food hoặc String
                if (tableValue instanceof Food) {
                    tableFoodName = ((Food) tableValue).getName();
                } else if (tableValue instanceof String) {
                    tableFoodName = (String) tableValue;
                }

                System.out.println("Dòng " + i + ": " + tableFoodName);
                if (selectedFoodName.equals(tableFoodName)) {
                    foodExists = true;
                    existingRowIndex = i;
                    System.out.println("Tìm thấy đồ ăn đã có ở dòng: " + i);
                    break;
                }
            }

            if (foodExists) {
                System.out.println("Đồ ăn đã có, sẽ tăng số lượng");
                // Nếu đồ ăn đã có, tăng số lượng
                int currentCount = (Integer) tbInfo.getValueAt(existingRowIndex, 1);
                int newCount = currentCount + billinfo.getCount();
                float unitPrice = (Float) tbInfo.getValueAt(existingRowIndex, 2);
                float newTotalPrice = newCount * unitPrice;

                // Cập nhật dòng trong bảng
                tbInfo.setValueAt(newCount, existingRowIndex, 1);
                tbInfo.setValueAt(newTotalPrice, existingRowIndex, 3);

                // Cập nhật trong database - thay vì insert mới, update record cũ
                try {
                    // Tìm record cũ trong database và update số lượng
                    List<Billinfo> existingBillInfos = billifdao.selectByBillId(showIdBill());
                    for (Billinfo existingInfo : existingBillInfos) {
                        if (existingInfo.getIdfood().equals(billinfo.getIdfood())) {
                            // Update số lượng trong database
                            existingInfo.setCount(newCount);
                            billifdao.update(existingInfo);
                            break;
                        }
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                }

                XDialog.info(this, "Đã tăng số lượng " + selectedFoodName + " lên " + newCount);
            } else {
                System.out.println("Đồ ăn chưa có, sẽ thêm mới");
                // Nếu đồ ăn chưa có, thêm mới
                System.out.println("Gọi billifdao.insert()...");
                billifdao.insert(billinfo);
                System.out.println("Insert thành công, gọi loadDataonTable()...");
                this.loadDataonTable();
                XDialog.info(this, "Đã thêm " + selectedFoodName + " vào hóa đơn");
            }

            snpCount.setValue(1);
            calTotalPice(); // Tính lại tổng tiền
            System.out.println("=== KẾT THÚC INSERT BILLINFO ===");
        } catch (Exception e) {
            System.err.println("Lỗi trong insertBillinfo: " + e.getMessage());
            e.printStackTrace();
            XDialog.alert(this, "Lỗi khi thêm đồ ăn!");
        }
    }

    /**
     * Cập nhật thông tin chi tiết cho tất cả Billinfo records của bill hiện tại
     */
    private void updateBillInfoDetails() {
        try {
            int billId = showIdBill();
            System.out.println("Đang cập nhật thông tin chi tiết cho Bill ID: " + billId);

            List<Billinfo> billInfos = billifdao.selectByBillId(billId);
            System.out.println("Tìm thấy " + billInfos.size() + " records để cập nhật");

            // Lấy thông tin từ các trường
            double hourlyRate = parseCurrency(lbTienGio.getText());
            double discountAmount = parseCurrency(txtGiamGia.getText());
            double serviceFee = parseCurrency(txtPhiDichVu.getText());
            double otherFee = parseCurrency(txtPhiKhac.getText());
            String notes = txtGhiChu.getText();

            System.out.println("Thông tin cập nhật:");
            System.out.println("- Tiền giờ: " + hourlyRate);
            System.out.println("- Giảm giá: " + discountAmount);
            System.out.println("- Phí dịch vụ: " + serviceFee);
            System.out.println("- Phí khác: " + otherFee);
            System.out.println("- Ghi chú: " + notes);

            if (billInfos.isEmpty()) {
                // Nếu không có Billinfo, tạo một record mới với thông tin cơ bản
                System.out.println("Không có Billinfo, tạo record mới");

                // Lấy một Food ID hợp lệ từ database
                String validFoodId = getValidFoodId();
                if (validFoodId == null) {
                    System.err.println("Không tìm thấy Food ID hợp lệ!");
                    return;
                }

                Billinfo newInfo = new Billinfo();
                newInfo.setIdbill(billId);
                newInfo.setIdfood(validFoodId); // Sử dụng Food ID hợp lệ
                newInfo.setCount(0);
                newInfo.setFoodName("Chỉ tính tiền giờ");
                newInfo.setUnitPrice(0.0f);
                newInfo.setHourlyRate(hourlyRate);
                newInfo.setDiscountAmount(discountAmount);
                newInfo.setServiceFee(serviceFee);
                newInfo.setOtherFee(otherFee);
                newInfo.setNotes(notes);

                billifdao.insert(newInfo);
                System.out.println("Đã tạo Billinfo mới cho Bill ID: " + billId);
            } else {
                // Cập nhật tất cả records hiện có
                for (Billinfo info : billInfos) {
                    info.setHourlyRate(hourlyRate);
                    info.setDiscountAmount(discountAmount);
                    info.setServiceFee(serviceFee);
                    info.setOtherFee(otherFee);
                    info.setNotes(notes);
                    billifdao.update(info);
                }
                System.out.println("Đã cập nhật " + billInfos.size() + " records Billinfo");
            }

            System.out.println("Cập nhật thông tin chi tiết Billinfo thành công!");
        } catch (Exception e) {
            e.printStackTrace();
            System.err.println("Lỗi khi cập nhật thông tin chi tiết Billinfo: " + e.getMessage());
        }
    }

    //TienGio
    private void tinhTienGio() {
        try {
            // Lấy giá tiền từ bàn được chọn
            TableDAO tableDAO = new TableDAOImpl();
            Table table = tableDAO.findById(idtable);

            if (table != null) {
                // Set giá tiền mỗi phút từ database
                double pricePerMinute = table.getPrice() / 60.0; // Chuyển từ VNĐ/giờ sang VNĐ/phút
                hourlyRateCalculator.setHourlyRate(pricePerMinute);
            }

            hourlyRateCalculator.startTimer();
        } catch (Exception e) {
            System.err.println("Lỗi khi lấy giá tiền bàn: " + e.getMessage());
            // Sử dụng giá mặc định nếu có lỗi
            hourlyRateCalculator.setHourlyRate(1000.0); // 1k/phút
            hourlyRateCalculator.startTimer();
        }
    }

    //Check input
    private void checkinput() {
        try {
            int giamgia = Integer.parseInt(txtGiamGia.getText());
            int phidichvu = Integer.parseInt(txtPhiDichVu.getText());
            int phikhac = Integer.parseInt(txtPhiKhac.getText());
            if (giamgia < 0 || phidichvu < 0 || phikhac < 0) {
                XDialog.alert(this, "Vui lòng nhập số dương");
            }
        } catch (Exception e) {
            XDialog.alert(this, "Vui lòng nhập số hợp lệ!");
        }
    }

    //Tính tổng tiền
    private void calTotalPice() {
        this.checkinput();
        float tong = 0;
        this.updatelbTienGio();

        // Tính tổng từ bảng với validation
        for (int i = 0; i < tbInfo.getRowCount(); i++) {
            Object value = tbInfo.getValueAt(i, 3);
            if (value != null) {
                float thanhtien = 0;
                if (value instanceof Number) {
                    thanhtien = ((Number) value).floatValue();
                } else if (value instanceof String) {
                    thanhtien = parseCurrency((String) value);
                }
                tong += thanhtien;
            }
        }

        // Cộng các khoản khác với validation
        tong += parseCurrency(lbTienGio.getText());
        tong -= parseCurrency(txtGiamGia.getText());
        tong += parseCurrency(txtPhiDichVu.getText());
        tong += parseCurrency(txtPhiKhac.getText());

        lbTongTien.setText(formatCurrency(tong));
    }

    //insert Bill
    private void insertBill() {
        hourlyRateCalculator.reset(); // Đặt lại tiền giờ khi bắt đầu bàn mới
        tinhTienGio();
        txtTimeStart.setText(XDateHelper.stringsnowFormatted());
        Bill model = getBill();
        try {
            billdao.insert(model);
            XDialog.info(this, "Thành công");
        } catch (Exception e) {
            e.printStackTrace();
            XDialog.alert(this, "Lỗi!");
        }
    }

    private void updateBill() {
        Bill model = getBill();
        try {
            // Chuyển đổi từ định dạng hiển thị về định dạng database để lưu
            String displayTime = txtTimeStop.getText();
            if (displayTime != null && !displayTime.trim().isEmpty()) {
                try {
                    // Parse từ định dạng "HH:mm:ss - dd/MM/yyyy" về Date
                    SimpleDateFormat displayFormat = new SimpleDateFormat("HH:mm:ss - dd/MM/yyyy");
                    Date checkoutDate = displayFormat.parse(displayTime);
                    model.setDatecheckout(checkoutDate);
                } catch (Exception e) {
                    // Fallback: sử dụng định dạng cũ nếu có lỗi
                    model.setDatecheckout(XDateHelper.toDate(txtTimeStop.getText()));
                }
            }
            model.setStatus(1);
            float totalPrice = parseCurrency(lbTongTien.getText());
            model.setTotalPrice(totalPrice);
            model.setId(showIdBill());

            // Debug log
            System.out.println("Updating bill ID: " + model.getId()
                    + " with TotalPrice: " + totalPrice);

            // Lưu thông tin user hiện tại đang đăng nhập
            if (currentUser != null) {
                model.setUsername(currentUser.getUsername());
            }
            billdao.update(model);
            // KHÔNG gọi clearBill() ở đây nữa để tránh reset TotalPrice
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    //load data on Table
    private void loadDataonTable() {
        modelTable = (DefaultTableModel) tbInfo.getModel();
        modelTable.setRowCount(0);
        try {
            this.showDateCheckin();
            List<Menu> m = menudao.selectAllMenuByIdTable(idtable);
            for (Menu menu : m) {
                if (m != null) {
                    Object[] row = {
                        menu.getFoodname(),
                        menu.getCount(),
                        menu.getPrice(),
                        menu.getTotalPrice()
                    };
                    modelTable.addRow(row);
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    //event Action
    private void eventAction() {
        SwingUtilities.invokeLater(() -> {
            clickTable();
        });
    }

    //Select showCHeckin
    private void showDateCheckin() {
        try {
            Timestamp bill = billdao.findDatebyIdtable(idtable);
            if (bill != null) {
                txtTimeStart.setText(XDateHelper.toStringFormatted(bill));
                btnStart.setEnabled(false);
                btnStopContinue.setEnabled(true);

                // Khôi phục thời gian chơi nếu bàn đang được sử dụng
                if (bill != null) {
                    // Tính toán thời gian đã chơi từ thời điểm bắt đầu
                    long startTimeMillis = bill.getTime();
                    long currentTime = System.currentTimeMillis();
                    long elapsedTime = currentTime - startTimeMillis;

                    // Cập nhật thời gian đã chơi
                    long hours = elapsedTime / (1000 * 60 * 60);
                    long minutes = (elapsedTime % (1000 * 60 * 60)) / (1000 * 60);
                    long seconds = (elapsedTime % (1000 * 60)) / 1000;

                    String timeString = String.format("%02d:%02d:%02d", hours, minutes, seconds);
                    lbTime.setText(timeString);

                    // Bắt đầu timer để tiếp tục cập nhật thời gian
                    startTime = startTimeMillis;
                    isPlaying = true;
                    if (playTimeTimer != null) {
                        playTimeTimer.start();
                    }
                }
            } else {
                txtTimeStart.setText("");
                btnStart.setEnabled(true);
                btnStopContinue.setEnabled(false);

                // Reset thời gian chơi nếu bàn trống
                resetPlayTime();
            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    //Click ThanhToan
    private void clickThanhToan() {
        modelTable = (DefaultTableModel) tbInfo.getModel();
        modelTable.setRowCount(0);
        try {
            // 1. Cập nhật thông tin chi tiết cho tất cả Billinfo records
            this.updateBillInfoDetails();

            // 2. Update bill trước (set status = 1 và username)
            this.updateBill();

            // 3. Sau đó mới gọi stored procedure để xóa
            billifdao.deleteBillInfo();

            // 4. Clear bill sau khi đã lưu thành công
            this.clearBill();

            // Reset thời gian chơi sau khi thanh toán
            resetPlayTime();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    //**************billTamTinh
    private void billTamTinh() {
        try {
            List<Menu> m = menudao.selectAllMenuByIdTable(idtable);
            XDialog.info(this,
                    "Mã hóa đơn :" + lbMaHoaDon.getText()
                    + "\nNgày tạo :" + txtTimeStop.getText()
                    + "\nBàn khách chơi :" + lbTable.getText()
                    + "\nGiờ vào :" + txtTimeStart.getText()
                    + "\nGiờ ra : " + txtTimeStop.getText()
                    + "\nTổng thời gian đã chơi :" + lbTime.getText()
                    + "\nTiền giờ :" + lbTienGio.getText()
                    + "\nGiảm giá :" + txtGiamGia.getText()
                    + "\nPhí dịch vụ : " + txtPhiDichVu.getText()
                    + "\nPhí khác :" + txtPhiKhac.getText()
                    + "\n-----------------------------------------------------------\n"
                    + "Mặt hàng --- Số lượng --- Giá --- Thành tiền\n"
                    + m.toString()
                    + "\n-----------------------------------------------------------\n"
                    + "TỔNG :" + lbTongTien.getText()
            );
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /**
     * Lấy tên hiển thị của bàn dựa trên ID
     *
     * @param tableId ID của bàn
     * @return Tên hiển thị của bàn
     */
    private String getTableDisplayName(int tableId) {
        switch (tableId) {
            // Bàn Liber (Thường) - ID 2-13
            case 1:
                return "Bàn liber 1";
            case 2:
                return "Bàn liber 2";
            case 3:
                return "Bàn liber 3";
            case 4:
                return "Bàn liber 4";
            case 5:
                return "Bàn liber 5";
            case 6:
                return "Bàn liber 6";
            case 7:
                return "Bàn liber 7";
            case 8:
                return "Bàn liber 8";
            case 9:
                return "Bàn liber 9";
            case 10:
                return "Bàn liber 10";
            case 11:
                return "Bàn liber 11";
            case 12:
                return "Bàn liber 12";

            // Bàn VIP - ID 19-21
            case 13:
                return "Bàn VIP 1";
            case 14:
                return "Bàn VIP 2";
            case 15:
                return "Bàn VIP 3";

            // Bàn Lỗ - ID 14-18
            case 16:
                return "Bàn lỗ 1";
            case 17:
                return "Bàn lỗ 2";
            case 18:
                return "Bàn lỗ 3";
            case 19:
                return "Bàn lỗ 4";
            case 20:
                return "Bàn lỗ 5";

            default:
                return "Bàn " + tableId;
        }
    }

    /**
     * Kiểm tra xem có bàn nào chưa thanh toán không
     *
     * @return true nếu có bàn chưa thanh toán, false nếu tất cả đã thanh toán
     */
    private boolean checkUnpaidTables() {
        try {
            // Lấy danh sách tất cả các bàn có bill chưa thanh toán (status = 0)
            String sql = "SELECT DISTINCT idTable FROM Bill WHERE status = 0";
            List<Integer> unpaidTables = new ArrayList<>();

            try (java.sql.ResultSet rs = poly.billiards.util.XJdbc.exeQuery(sql)) {
                while (rs.next()) {
                    unpaidTables.add(rs.getInt("idTable"));
                }
            }

            if (!unpaidTables.isEmpty()) {
                // Tạo danh sách tên bàn chưa thanh toán
                StringBuilder tableNames = new StringBuilder();
                for (int i = 0; i < unpaidTables.size(); i++) {
                    if (i > 0) {
                        tableNames.append(", ");
                    }
                    // Sử dụng mapping để hiển thị tên bàn chính xác
                    tableNames.append(getTableDisplayName(unpaidTables.get(i)));
                }

                XDialog.alert(this, "Các bàn sau chưa thanh toán xong:\n" + tableNames.toString());
                return true;
            }

            return false;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    public void showBillDetail(Bill bill) {
        // Chuyển sang tab chi tiết (index 1)
        tabs.setSelectedIndex(1);
        btnStart.setEnabled(false);
        btnXacNhan.setEnabled(false);
        btnXoasp.setEnabled(false);
        btnThanhToan.setEnabled(false);
        btnTamTinh.setEnabled(false);

        // Debug log
        System.out.println("Showing bill detail - ID: " + bill.getId()
                + ", TotalPrice: " + bill.getTotalPrice());

        // Hiển thị thông tin bill lên các trường cơ bản
        lbMaHoaDon.setText(String.valueOf(bill.getId()));
        lbTable.setText(bill.getTableName());
        txtTimeStart.setText(bill.getDatecheckin() != null ? XDateHelper.toString(bill.getDatecheckin(), "yyyy-MM-dd HH:mm:ss") : "");
        txtTimeStop.setText(bill.getDatecheckout() != null ? XDateHelper.toString(bill.getDatecheckout(), "yyyy-MM-dd HH:mm:ss") : "");
        lbTongTien.setText(bill.getTotalPrice() > 0 ? formatCurrency(bill.getTotalPrice()) : "");

        // Hiển thị chi tiết bill info (danh sách món)
        DefaultTableModel model = (DefaultTableModel) tbInfo.getModel();
        model.setRowCount(0);

        // Thử đọc từ Billinfo trước (cho hóa đơn chưa thanh toán)
        List<Billinfo> billInfos = billifdao.selectByBillId(bill.getId());

        System.out.println("Đang tìm Billinfo cho Bill ID: " + bill.getId());
        System.out.println("Đang thực hiện query: SELECT * FROM Billinfo WHERE idBill = ?");
        System.out.println("Đọc được " + billInfos.size() + " records từ Billinfo");

        // Nếu không có trong Billinfo, thử đọc từ BillInfoDeleted (cho hóa đơn đã thanh toán)
        if (billInfos.isEmpty()) {
            System.out.println("Không tìm thấy trong Billinfo, thử đọc từ BillInfoDeleted");
            billInfos = billifdao.selectByBillIdFromDeleted(bill.getId());
            System.out.println("Đọc được " + billInfos.size() + " records từ BillInfoDeleted");
        }

        if (!billInfos.isEmpty()) {
            // Lấy thông tin từ record đầu tiên để hiển thị các trường khác
            Billinfo firstInfo = billInfos.get(0);
            System.out.println("Thông tin từ record đầu tiên:");
            System.out.println("- Tiền giờ: " + firstInfo.getHourlyRate());
            System.out.println("- Giảm giá: " + firstInfo.getDiscountAmount());
            System.out.println("- Phí dịch vụ: " + firstInfo.getServiceFee());
            System.out.println("- Phí khác: " + firstInfo.getOtherFee());
            System.out.println("- Ghi chú: " + firstInfo.getNotes());

            lbTienGio.setText(formatCurrency((float) firstInfo.getHourlyRate()));
            txtGiamGia.setText(formatCurrency((float) firstInfo.getDiscountAmount()));
            txtPhiDichVu.setText(formatCurrency((float) firstInfo.getServiceFee()));
            txtPhiKhac.setText(formatCurrency((float) firstInfo.getOtherFee()));
            txtGhiChu.setText(firstInfo.getNotes() != null ? firstInfo.getNotes() : "");
        } else {
            // Nếu không có Billinfo, hiển thị thông tin từ Bill
            System.out.println("Không có Billinfo, sử dụng thông tin từ Bill");
            lbTienGio.setText("");
            txtGiamGia.setText("");
            txtPhiDichVu.setText("");
            txtPhiKhac.setText("");
            txtGhiChu.setText("");
        }

        for (Billinfo info : billInfos) {
            // Sử dụng dữ liệu đã lưu trong Billinfo thay vì query FoodDAO
            Object[] row = {
                info.getFoodName() != null ? info.getFoodName() : "",
                info.getCount(),
                info.getUnitPrice(),
                info.getUnitPrice() * info.getCount()
            };
            model.addRow(row);
        }

        System.out.println("Đã hiển thị " + billInfos.size() + " món ăn trong bảng");
    }

    /**
     * Getter cho currentUser
     */
    public User getCurrentUser() {
        return currentUser;
    }

    /**
     * Lấy một Food ID hợp lệ từ database
     */
    private String getValidFoodId() {
        try {
            // Thử lấy Food có Available = 1 trước
            String sql = "SELECT TOP 1 Id FROM Food WHERE Available = 1";
            try (java.sql.ResultSet rs = poly.billiards.util.XJdbc.exeQuery(sql)) {
                if (rs.next()) {
                    return rs.getString("Id");
                }
            }

            // Nếu không có, lấy bất kỳ Food nào
            sql = "SELECT TOP 1 Id FROM Food";
            try (java.sql.ResultSet rs = poly.billiards.util.XJdbc.exeQuery(sql)) {
                if (rs.next()) {
                    return rs.getString("Id");
                }
            }

            System.err.println("Không tìm thấy Food nào trong database!");
        } catch (Exception e) {
            System.err.println("Lỗi khi lấy Food ID: " + e.getMessage());
        }
        return null;
    }

    private void btnLiber3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLiber3ActionPerformed
        // TODO: Thêm code xử lý sự kiện cho btnLiber3
    }//GEN-LAST:event_btnLiber3ActionPerformed
    private void btnLiber2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLiber2ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnLiber2ActionPerformed

    private DrawerController currentDrawer = null;

    private void btnDrawerManagerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDrawerManagerActionPerformed
        // TODO add your handling code here:
        if (currentDrawer != null) {
            if (currentDrawer.isShow()) {
                currentDrawer.hide();
            } else {
                currentDrawer.show();
            }
        }
    }//GEN-LAST:event_btnDrawerManagerActionPerformed

    private void btnDrawerUserActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDrawerUserActionPerformed
        // TODO add your handling code here:
        if (currentDrawer != null) {
            if (currentDrawer.isShow()) {
                currentDrawer.hide();
            } else {
                currentDrawer.show();
            }
        }
    }//GEN-LAST:event_btnDrawerUserActionPerformed

    private void btnToggleThemeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnToggleThemeActionPerformed
        // TODO add your handling code here:
        XUI.toggleTheme(this);
        updateThemeButtonText();
        // Update panel colors after theme change
        XUI.setPanelPadding(pnlLeft, 0, 0, 0, 0);
        XUI.setPanelPadding(pnlLeftCenter, 0, 0, 0, 0);
        
        // Set fixed colors for specific components
        txtTimeStart.setForeground(Color.BLACK);
        txtTimeStop.setForeground(Color.BLACK);
        btnTamTinh.setForeground(Color.BLACK);
        
        SwingUtilities.updateComponentTreeUI(this);

        // Reinitialize drawer with new theme
        initializeDrawerForUser();
    }//GEN-LAST:event_btnToggleThemeActionPerformed

    private void initializeDrawerForUser() {
        System.out.println("initializeDrawerForUser() called - currentUser: " + (currentUser != null ? currentUser.getFullname() : "null"));
        if (currentUser == null) {
            System.out.println("currentUser is null, returning early");
            return;
        }

        // Determine current theme
        boolean isDarkMode = XUI.isDarkMode();

        if (currentUser.isManager()) {
            if (isDarkMode) {
                currentDrawer = createManagerDarkDrawer();
            } else {
                currentDrawer = createManagerLightDrawer();
            }
        } else {
            if (isDarkMode) {
                currentDrawer = createUserDarkDrawer();
            } else {
                currentDrawer = createUserLightDrawer();
            }
        }
    }

    private DrawerController createManagerLightDrawer() {
        return Drawer.newDrawer(this)
                .background(new Color(90, 90, 90))
                .closeOnPress(true)
                .backgroundTransparent(0.3f)
                .leftDrawer(true)
                .enableScroll(true)
                .enableScrollUI(false)
                .headerHeight(160)
                .header(new HeaderDrawer(currentUser))
                .addChild(new DrawerItem("Đổi mật khẩu").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/padlock.png"))).build())
                .addChild(new DrawerItem("Lịch sử hoá đơn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/order-history.png"))).build())
                .space(10)
                .separator(HEIGHT, Color.GRAY)
                .space(10)
                .addChild(new DrawerItem("Lịch sử hoạt động").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/history.png"))).build())
                .addChild(new DrawerItem("Quản lý loại đồ ăn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/snacks.png"))).build())
                .addChild(new DrawerItem("Quản lý đồ ăn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/snacks.png"))).build())
                .addChild(new DrawerItem("Quản lý loại bàn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/pool-table.png"))).build())
                .addChild(new DrawerItem("Quản lý bàn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/pool-table.png"))).build())
                .addChild(new DrawerItem("Quản lý tài khoản").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/user.png"))).build())
                .addFooter(new DrawerItem("Đăng xuất").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/logout.png"))).build())
                .addFooter(new DrawerItem("Thoát").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/switch.png"))).build())
                .event(new EventDrawer() {
                    @Override
                    public void selected(int index, DrawerItem item) {
                        switch (index) {
                            case 0:
                                PolyBilliardsJFrame.this.showChangePasswordJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 1:
                                PolyBilliardsJFrame.this.showHistoryJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 2:
                                PolyBilliardsJFrame.this.showActivityHistoryJDialog(new javax.swing.JDialog(PolyBilliardsJFrame.this, true));
                                break;
                            case 3:
                                FoodCategoryManagerJDialog dialog = new FoodCategoryManagerJDialog(PolyBilliardsJFrame.this, true);
                                dialog.setDataChangeListener(PolyBilliardsJFrame.this);
                                dialog.setVisible(true);
                                break;
                            case 4:
                                FoodManagerJDialog dialog2 = new FoodManagerJDialog(PolyBilliardsJFrame.this, true);
                                dialog2.setDataChangeListener(PolyBilliardsJFrame.this);
                                dialog2.setVisible(true);
                                break;
                            case 5:
                                typeTableManagerJDialog dialog3 = new typeTableManagerJDialog();
                                dialog3.setLocationRelativeTo(PolyBilliardsJFrame.this);
                                dialog3.setVisible(true);
                                break;
                            case 6:
                                PolyBilliardsJFrame.this.showTableManagerJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 7:
                                PolyBilliardsJFrame.this.showUserManagerJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 8:
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn đăng xuất?")) {
                                    PolyBilliardsJFrame.this.dispose();
                                    // Restart by calling main method directly
                                    SwingUtilities.invokeLater(() -> {
                                        main(new String[0]);
                                    });
                                }
                                break;
                            case 9:
                                // Kiểm tra bàn chưa thanh toán trước khi thoát
                                if (checkUnpaidTables()) {
                                    // Có bàn chưa thanh toán, không làm gì cả (giữ cửa sổ mở)
                                    return;
                                }
                                // Không có bàn chưa thanh toán, thoát bình thường
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn thoát?")) {
                                    System.exit(0);
                                }
                                break;
                            default:
                                currentDrawer.hide();
                        }
                    }
                })
                .build();
    }

    private DrawerController createManagerDarkDrawer() {
        return Drawer.newDrawer(this)
                .drawerBackground(new Color(43, 43, 43))
                .closeOnPress(true)
                .backgroundTransparent(0.3f)
                .leftDrawer(true)
                .enableScroll(true)
                .enableScrollUI(false)
                .headerHeight(160)
                .header(new HeaderDrawer(currentUser))
                .addChild(new DrawerItem("Đổi mật khẩu").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/padlock.png"))).build())
                .addChild(new DrawerItem("Lịch sử hoá đơn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/order-history.png"))).build())
                .space(10)
                .separator(HEIGHT, Color.GRAY)
                .space(10)
                .addChild(new DrawerItem("Lịch sử hoạt động").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/history.png"))).build())
                .addChild(new DrawerItem("Quản lý loại đồ ăn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/snacks.png"))).build())
                .addChild(new DrawerItem("Quản lý đồ ăn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/snacks.png"))).build())
                .addChild(new DrawerItem("Quản lý loại bàn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/pool-table.png"))).build())
                .addChild(new DrawerItem("Quản lý bàn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/pool-table.png"))).build())
                .addChild(new DrawerItem("Quản lý tài khoản").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/manager/user.png"))).build())
                .addFooter(new DrawerItem("Đăng xuất").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/logout.png"))).build())
                .addFooter(new DrawerItem("Thoát").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/switch.png"))).build())
                .event(new EventDrawer() {
                    @Override
                    public void selected(int index, DrawerItem item) {
                        switch (index) {
                            case 0:
                                PolyBilliardsJFrame.this.showChangePasswordJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 1:
                                PolyBilliardsJFrame.this.showHistoryJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 2:
                                PolyBilliardsJFrame.this.showActivityHistoryJDialog(new javax.swing.JDialog(PolyBilliardsJFrame.this, true));
                                break;
                            case 3:
                                FoodCategoryManagerJDialog dialog = new FoodCategoryManagerJDialog(PolyBilliardsJFrame.this, true);
                                dialog.setDataChangeListener(PolyBilliardsJFrame.this);
                                dialog.setVisible(true);
                                break;
                            case 4:
                                FoodManagerJDialog dialog2 = new FoodManagerJDialog(PolyBilliardsJFrame.this, true);
                                dialog2.setDataChangeListener(PolyBilliardsJFrame.this);
                                dialog2.setVisible(true);
                                break;
                            case 5:
                                typeTableManagerJDialog dialog3 = new typeTableManagerJDialog();
                                dialog3.setLocationRelativeTo(PolyBilliardsJFrame.this);
                                dialog3.setVisible(true);
                                break;
                            case 6:
                                PolyBilliardsJFrame.this.showTableManagerJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 7:
                                PolyBilliardsJFrame.this.showUserManagerJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 8:
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn đăng xuất?")) {
                                    PolyBilliardsJFrame.this.dispose();
                                    // Restart by calling main method directly
                                    SwingUtilities.invokeLater(() -> {
                                        main(new String[0]);
                                    });
                                }
                                break;
                            case 9:
                                // Kiểm tra bàn chưa thanh toán trước khi thoát
                                if (checkUnpaidTables()) {
                                    // Có bàn chưa thanh toán, không làm gì cả (giữ cửa sổ mở)
                                    return;
                                }
                                // Không có bàn chưa thanh toán, thoát bình thường
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn thoát?")) {
                                    System.exit(0);
                                }
                                break;
                            default:
                                currentDrawer.hide();
                        }
                    }
                })
                .build();
    }

    private DrawerController createUserLightDrawer() {
        return Drawer.newDrawer(this)
                .background(new Color(90, 90, 90))
                .closeOnPress(true)
                .backgroundTransparent(0.3f)
                .leftDrawer(true)
                .enableScroll(true)
                .enableScrollUI(false)
                .headerHeight(160)
                .header(new HeaderDrawer(currentUser))
                .space(3)
                .addChild(new DrawerItem("Đổi mật khẩu").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/padlock.png"))).build())
                .addChild(new DrawerItem("Lịch sử hoá đơn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/order-history.png"))).build())
                .addFooter(new DrawerItem("Đăng xuất").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/logout.png"))).build())
                .addFooter(new DrawerItem("Thoát").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/switch.png"))).build())
                .event(new EventDrawer() {
                    @Override
                    public void selected(int index, DrawerItem item) {
                        switch (index) {
                            case 0:
                                PolyBilliardsJFrame.this.showChangePasswordJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 1:
                                PolyBilliardsJFrame.this.showHistoryJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 2:
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn đăng xuất?")) {
                                    PolyBilliardsJFrame.this.dispose();
                                    // Restart by calling main method directly
                                    SwingUtilities.invokeLater(() -> {
                                        main(new String[0]);
                                    });
                                }
                                break;
                            case 3:
                                // Kiểm tra bàn chưa thanh toán trước khi thoát
                                if (checkUnpaidTables()) {
                                    // Có bàn chưa thanh toán, không làm gì cả (giữ cửa sổ mở)
                                    return;
                                }
                                // Không có bàn chưa thanh toán, thoát bình thường
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn thoát?")) {
                                    System.exit(0);
                                }
                                break;
                            default:
                                currentDrawer.hide();
                        }
                    }
                })
                .build();
    }

    private DrawerController createUserDarkDrawer() {
        return Drawer.newDrawer(this)
                .drawerBackground(new Color(43, 43, 43))
                .closeOnPress(true)
                .backgroundTransparent(0.3f)
                .leftDrawer(true)
                .enableScroll(true)
                .enableScrollUI(false)
                .headerHeight(160)
                .header(new HeaderDrawer(currentUser))
                .space(3)
                .addChild(new DrawerItem("Đổi mật khẩu").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/padlock.png"))).build())
                .addChild(new DrawerItem("Lịch sử hoá đơn").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/order-history.png"))).build())
                .addFooter(new DrawerItem("Đăng xuất").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/logout.png"))).build())
                .addFooter(new DrawerItem("Thoát").icon(new ImageIcon(getClass().getResource("/poly/billiards/icons/menu/switch.png"))).build())
                .event(new EventDrawer() {
                    @Override
                    public void selected(int index, DrawerItem item) {
                        switch (index) {
                            case 0:
                                PolyBilliardsJFrame.this.showChangePasswordJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 1:
                                PolyBilliardsJFrame.this.showHistoryJDialog(PolyBilliardsJFrame.this);
                                break;
                            case 2:
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn đăng xuất?")) {
                                    PolyBilliardsJFrame.this.dispose();
                                    // Restart by calling main method directly
                                    SwingUtilities.invokeLater(() -> {
                                        main(new String[0]);
                                    });
                                }
                                break;
                            case 3:
                                // Kiểm tra bàn chưa thanh toán trước khi thoát
                                if (checkUnpaidTables()) {
                                    // Có bàn chưa thanh toán, không làm gì cả (giữ cửa sổ mở)
                                    return;
                                }
                                // Không có bàn chưa thanh toán, thoát bình thường
                                if (XDialog.confirm(PolyBilliardsJFrame.this, "Bạn có muốn thoát?")) {
                                    System.exit(0);
                                }
                                break;
                            default:
                                currentDrawer.hide();
                        }
                    }
                })
                .build();
    }

}
